{"version":3,"file":"index.js","sources":["../src/components/Settings.tsx","../node_modules/didyoumean/didYouMean-1.2.1.min.js","../src/emojify/index.ts","../src/index.js"],"sourcesContent":["/**\n * Powercord Plugin Emojifier\n *\n * @license MIT\n * @copyright (C) 2021 Luke Zhang\n */\n\nimport {React} from \"powercord/webpack\"\nimport {SwitchItem} from \"powercord/components/settings\"\n\ninterface Props {\n    getSetting(name: string, def: boolean): boolean\n    toggleSetting(name: string): void\n}\n\ninterface State {\n    emojifierEnabled: boolean\n    shouldUseFuzzyWordMatch: boolean\n}\n\nexport default class Settings extends React.Component<Props, State> {\n    public constructor(props: Props) {\n        super(props)\n\n        this.state = {\n            emojifierEnabled: this.props.getSetting(\"emojifierEnabled\", false),\n            shouldUseFuzzyWordMatch: this.props.getSetting(\"shouldUseFuzzyWordMatch\", false),\n        }\n    }\n\n    public render = () => (\n        <>\n            <SwitchItem\n                note=\"Auto emojify toggle.\"\n                value={this.state.emojifierEnabled}\n                onChange={() => {\n                    this.setState({emojifierEnabled: !this.state.emojifierEnabled})\n                    this.props.toggleSetting(\"emojifierEnabled\")\n                }}\n            >\n                Enable\n            </SwitchItem>\n            <SwitchItem\n                note=\"Match words with fuzzy word match.\"\n                value={this.state.shouldUseFuzzyWordMatch}\n                onChange={() => {\n                    this.setState({shouldUseFuzzyWordMatch: !this.state.shouldUseFuzzyWordMatch})\n                    this.props.toggleSetting(\"shouldUseFuzzyWordMatch\")\n                }}\n            >\n                Use fuzzy word match\n            </SwitchItem>\n        </>\n    )\n}\n","/*\n  didYouMean.js copyright (c) 2013-2014 Dave Porter.\n\n  [Available on GitHub](https://github.com/dcporter/didyoumean.js).\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License\n  [here](http://www.apache.org/licenses/LICENSE-2.0).\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n(function(){\"use strict\";function e(t,r,i){if(!t)return null;if(!e.caseSensitive){t=t.toLowerCase()}var s=e.threshold===null?null:e.threshold*t.length,o=e.thresholdAbsolute,u;if(s!==null&&o!==null)u=Math.min(s,o);else if(s!==null)u=s;else if(o!==null)u=o;else u=null;var a,f,l,c,h,p=r.length;for(h=0;h<p;h++){f=r[h];if(i){f=f[i]}if(!f){continue}if(!e.caseSensitive){l=f.toLowerCase()}else{l=f}c=n(t,l,u);if(u===null||c<u){u=c;if(i&&e.returnWinningObject)a=r[h];else a=f;if(e.returnFirstMatch)return a}}return a||e.nullResultValue}function n(e,n,r){r=r||r===0?r:t;var i=e.length;var s=n.length;if(i===0)return Math.min(r+1,s);if(s===0)return Math.min(r+1,i);if(Math.abs(i-s)>r)return r+1;var o=[],u,a,f,l,c;for(u=0;u<=s;u++){o[u]=[u]}for(a=0;a<=i;a++){o[0][a]=a}for(u=1;u<=s;u++){f=t;l=1;if(u>r)l=u-r;c=s+1;if(c>r+u)c=r+u;for(a=1;a<=i;a++){if(a<l||a>c){o[u][a]=r+1}else{if(n.charAt(u-1)===e.charAt(a-1)){o[u][a]=o[u-1][a-1]}else{o[u][a]=Math.min(o[u-1][a-1]+1,Math.min(o[u][a-1]+1,o[u-1][a]+1))}}if(o[u][a]<f)f=o[u][a]}if(f>r)return r+1}return o[s][i]}e.threshold=.4;e.thresholdAbsolute=20;e.caseSensitive=false;e.nullResultValue=null;e.returnWinningObject=null;e.returnFirstMatch=false;if(typeof module!==\"undefined\"&&module.exports){module.exports=e}else{window.didYouMean=e}var t=Math.pow(2,32)-1})();","/**\n * Emojifier\n *\n * @license MIT\n * @copyright (c) 2020 oldpepper12, 2021 Luke Zhang\n * @see {@link https://github.com/oldpepper12/emojibot2/blob/master/docs/main.js}\n */\n\nimport data from \"../../data/emoji-mappings.json\"\nimport didyoumean from \"didyoumean/didYouMean-1.2.1.min.js\"\n\ndidyoumean.threshold = 0.7\n\nconst sample = <T>(items: T[]): T => items[Math.floor(Math.random() * items.length)] as T\n\nfunction* range(start: number, stop?: number, step = 1): Generator<number, void, void> {\n    for (let i = stop ? start : 0; i < (stop ?? start); i += step) {\n        yield i\n    }\n\n    return\n}\n\nconst stripWord = (word: string): string =>\n    word\n        .split(\"\")\n        .filter((char) => /[A-z]|-|_/u.test(char))\n        .join(\"\")\n        .toLowerCase()\n\nconst getFuzzyString = (key: string): string | undefined => {\n    const result = didyoumean(key, Object.keys(data))\n\n    return result instanceof Array ? result[0] : result\n}\n\nconst emojifyLine = (\n    text: string,\n    shouldUseFuzzyWordMatch = false,\n    lenProbabilities = [1, 1, 1, 1, 2, 2, 3],\n): string =>\n    text\n        .split(\" \")\n        .map((word) => {\n            const strippedWord = stripWord(word)\n\n            if (strippedWord) {\n                const emojiString = Array.from(range(sample(lenProbabilities)))\n                    .map(() => {\n                        let emojis = (data as {[key: string]: string[]})[strippedWord]\n\n                        if (emojis === undefined && shouldUseFuzzyWordMatch) {\n                            const fuzzyWord = getFuzzyString(strippedWord)\n\n                            if (fuzzyWord && fuzzyWord !== strippedWord) {\n                                emojis = (data as {[key: string]: string[]})[fuzzyWord]\n                            }\n                        }\n\n                        return sample(emojis ?? [])\n                    })\n                    .join(\"\")\n\n                return word + emojiString + \" \"\n            } else {\n                return word + \" \"\n            }\n        })\n        .join(\"\")\n\nexport const emojify = (\n    text: string,\n    shouldUseFuzzyWordMatch = false,\n    lenProbabilities = [1, 1, 1, 1, 2, 2, 3],\n) =>\n    text\n        .split(/\\n/g)\n        .map((line) => emojifyLine(line, shouldUseFuzzyWordMatch, lenProbabilities))\n        .join(\"\\n\")\n\nexport default emojify\n","/**\n * Powercord Plugin Emojifier\n *\n * @license MIT\n * @copyright (C) 2021 Luke Zhang\n */\n\nimport {React, getModule} from \"powercord/webpack\"\nimport {inject, uninject} from \"powercord/injector\"\nimport {Plugin} from \"powercord/entities\"\nimport Settings from \"./components/Settings\"\nimport emojify from \"./emojify\"\n\nexport default class Emojify extends Plugin {\n    async startPlugin() {\n        powercord.api.settings.registerSettings(this.entityID, {\n            category: this.entityID,\n            label: \"Emojifier\",\n            render: (props) =>\n                React.createElement(Settings, {\n                    main: this,\n                    ...props,\n                }),\n        })\n\n        const parentThis = this // For some reason this has to be done\n        const messageEvents = await getModule([\"sendMessage\"])\n\n        inject(\n            \"emojifierSend\",\n            messageEvents,\n            \"sendMessage\",\n            (args) => {\n                if (parentThis.settings.get(\"emojifierEnabled\", false)) {\n                    let text = args[1].content\n\n                    text = emojify(text, parentThis.settings.get(\"shouldUseFuzzyWordMatch\", false))\n                    args[1].content = text\n                }\n\n                return args\n            },\n            true,\n        )\n\n        powercord.api.commands.registerCommand({\n            command: \"emojify\",\n            description: \"emojify your message\",\n            usage: \"{c} [ text ]\",\n            executor: (args) => ({\n                send: true,\n                result: emojify(\n                    args.join(\" \"),\n                    parentThis.settings.get(\"shouldUseFuzzyWordMatch\", false),\n                ),\n            }),\n        })\n\n        powercord.api.commands.registerCommand({\n            command: \"toggleEmojify\",\n            description: `emojify all of your messages`,\n            executor: () => {\n                let emojifierAutoToggle = this.settings.get(\"emojifierEnabled\", false)\n\n                this.settings.set(\"emojifierEnabled\", !emojifierAutoToggle)\n            },\n        })\n    }\n\n    pluginWillUnload() {\n        powercord.api.settings.unregisterSettings(this.entityID)\n        uninject(\"emojifierSend\")\n        powercord.api.commands.unregisterCommand(\"toggleEmojify\")\n        powercord.api.commands.unregisterCommand(\"emojify\")\n    }\n}\n"],"names":["Settings","React","Component","[object Object]","props","super","this","SwitchItem","note","value","state","emojifierEnabled","onChange","setState","toggleSetting","shouldUseFuzzyWordMatch","getSetting","e","t","r","i","caseSensitive","toLowerCase","u","s","threshold","length","o","thresholdAbsolute","Math","min","a","f","c","h","p","n","returnWinningObject","returnFirstMatch","nullResultValue","abs","l","charAt","module","exports","window","didYouMean","pow","didyoumean","sample","items","floor","random","emojifyLine","text","lenProbabilities","split","map","word","strippedWord","filter","char","test","join","stripWord","Array","from","start","stop","step","range","emojis","data","undefined","fuzzyWord","key","result","Object","keys","getFuzzyString","emojify","line","Emojify","Plugin","powercord","api","settings","registerSettings","entityID","category","label","render","createElement","main","parentThis","messageEvents","getModule","inject","args","get","content","commands","registerCommand","command","description","usage","executor","send","emojifierAutoToggle","set","unregisterSettings","uninject","unregisterCommand"],"mappings":"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"}